<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>添加新地址</title>
<meta
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"
	name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta content="telephone=no" name="format-detection" />
<link href="/onlinemail/css/address.css" rel="stylesheet"
	type="text/css" />
<link href="/onlinemail/css/jquery.spinner.css" rel="stylesheet"
	type="text/css" />
<style type="text/css">
.el-row {
	box-sizing: border-box;
}

.scolleShow {
	overflow: auto;
	margin-top: 5px;
	height: 60px;
}

.addAddressCons {
	font-weight: bold;
}

.addAddress {
	float: right;
	color: #05226C;
	cursor: pointer;
}
</style>
</head>
<body style="background: #f7f7f7">
	
	<div id="showAddr"
		style="width: 100%; height: 100%; position: absolute; top: 0px; left: 0px; background-color: white; z-index: 20;">
		<section class="aui-flexView">
			<header class="aui-navBar aui-navBar-fixed">
				<a href="javascript:;" onclick="closeAddAddr()"
					class="aui-navBar-item"></a>
				<div class="aui-center">
					<span class="aui-center-title"></span>
				</div>
				<a href="javascript:;" onclick="addAddre()" class="aui-navBar-item"> <i
					 class="icon icon-sys"></i> 保存
				</a>
			</header>
			<section class="aui-scrollView" id="addFrom">
			
				<div class="aui-address-box">
					<div class="aui-address-cell-item">
						<div class="aui-cell-name">收货人</div>
						<div class="aui-cell-input">
							<input type="text" class="cell-input" id="userName"  valid="required" placeholder="请输入收货人姓名!"
								autocomplete="off">
						</div>
					</div>
					<div class="aui-address-cell-item">
						<div class="aui-cell-name">联系电话</div>
						<div class="aui-cell-input">
							<input type="text" class="cell-input" id="addrPhone"  valid="required,phone"  placeholder="请输入收货人电话!"
								autocomplete="off">
						</div>
					</div>
					<div class="aui-address-cell-item">
						<div class="aui-cell-name">所在地区</div>
						<div class="aui-cell-input cell-input-text">
							<input type="text" value="" class="cell-input" id="addrZone"  valid="required"  readonly="readonly"
								 placeholder="请选择收货地址">
						</div>
					</div>
					<div class="aui-address-cell-item">
						<div class="aui-cell-name">详细地址</div>
						<div class="aui-cell-input">
							<input type="text" valid="required" id="addrDetail"  class="cell-input" placeholder="请输入详细地址"
								autocomplete="off">
						</div>
					</div>
					<div class="aui-radio">
						<input type="checkbox" id="isDeafualt"  checked="" >设为默认地址
					</div>
				</div>
				
				<input  type="hidden" id="userOpenid" th:value="${openid}" />
				<input  type="hidden" id="goodsid" th:value="${goodsId}" />
			</section>
		</section>
	</div>
	
	<script src="/utils/js/jquery.min.js"></script>
	<script src="/utils/js/utils.js"></script>
	<script src="/onlinemail/js/city.js"></script>
	<script src="/onlinemail/js/address.js"></script>
	<script>
		//防止重复点击
		var submit = false;
		entity.codeBorder=false;
		function closeAddAddr(){
			window.location.href='/bxNuoOrder/toPayPage/?goodsid='+$('#goodsid').val()+'&openid='+$('#userOpenid').val();
		}
		function addAddre() {
			if (submit) {
				return;
			}
			submit = true;
			//传递code和state去addOrder增加订单
			
			var order = validateFrom('addFrom');
			if(!order.res){
				submit = false;
				return;
			}
			//获取数据后
			$.ajax({
				type : "POST",
				url : "/bxNuoAddr/add",
				async : true,
				data : order,
				success : function(data) {
					if(data.code=="000000"){
						alert('保存成功');
						//前往购买页面
						window.location.href='/bxNuoOrder/toPayPage/?goodsid='+$('#goodsid').val()+'&openid='+$('#userOpenid').val();
					}else{
						alert(data.msg);
					}
					submit = false;
				},error:function(){
					submit = false;
				}
			});
		}
	</script>
	<script>
		
		/**
		 * 默认调用
		 */
		!function() {
			var $target = $('#addrZone');

			$target.citySelect();

			$target.on('click', function(event) {
				event.stopPropagation();
				$target.citySelect('open');
			});

			$target.on('done.ydui.cityselect', function(ret) {
				$(this).val(ret.provance + ' ' + ret.city + ' ' + ret.area);
			});
		}();
		function hide_new_addrList() {
			window.history.go(-1);
		}
	</script>
</body>

</html>